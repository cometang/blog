---
title: webpack多页应用打包
date: 2021-04-12 18:54:30
permalink: /pages/935a48/
categories:
  - 前端
  - JavaScript
  - webpack 
tags:
  - 
---


## 1. 多页面应用打包

### 1.1 yarn创建项目

```js
yarn init -y 
```

###  1.2 创建默认的项目文件目录 src

```js
test
├── src
│   ├── css
│   │   ├── home.less
│   │   ├── login.less
│   │   └── register.less
│   ├── fonts
│   ├── img
│   ├── js
│   │   ├── home.js
│   │   ├── login.js
│   │   └── register.js
│   ├── lib
│   └── page
│       ├── home.html
│       ├── login.html
│       └── register.html
├── .babelrc
├── package.json
└── webpack.config.js
```

### 1.3 默认配置 

将之前的单页面的默认配置复制粘贴

#### 1.3.1 package.json 

```json
{
  "name": "test",
  "version": "1.0.0",
  "main": "index.js",
  "license": "MIT",
  "scripts": {
    "serve": "cross-env NODE_ENV=development webpack serve",
    "build": "cross-env NODE_ENV=production webpack"
  },
  "devDependencies": {
    "babel-core": "^6.26.3",
    "babel-loader": "7.1.5",
    "babel-preset-es2015": "^6.24.1",
    "cross-env": "^7.0.3",
    "css-loader": "^5.2.0",
    "file-loader": "^6.2.0",
    "html-loader": "1.3.2",
    "html-webpack-plugin": "5.0.0-beta.1",
    "less": "^4.1.1",
    "less-loader": "^8.0.0",
    "mini-css-extract-plugin": "^1.4.1",
    "optimize-css-assets-webpack-plugin": "^5.0.4",
    "style-loader": "^2.0.0",
    "url-loader": "^4.1.1",
    "webpack": "5.11.0",
    "webpack-cli": "^4.6.0",
    "webpack-dev-server": "^3.11.2"
  },
  "dependencies": {}
}
```

#### 1.3.2 webpack.config.js

```js
/**
 * webpack 打包配置文件
 */

//引入nodejs内置模块，可以拿到当前文件的跟目录
const path = require('path');
//引入html打包的插件 
const HtmlWebpackPlugin = require('html-webpack-plugin');
//引入 提取js中的css代码的插件
const MiniCssExtractPlugin = require('mini-css-extract-plugin');
//将css文件及代码进行极致压缩s
const OptimizeCssAssetsWebpackPlugin = require('optimize-css-assets-webpack-plugin');

module.exports = {
    //入口
    entry: './src/js/index.js',   //相对路径
    //出口
    output: {
        path: path.resolve(__dirname, 'dist'),   
        filename: 'bundle.js',       
        publicPath: './'            
    },
    //loader 
    module: {
        rules: [
            { 
                //配置css loader
                test: /\.css$/,          
                use: [MiniCssExtractPlugin.loader, 'css-loader']
            },
            {
                //配置less loader 
                test: /\.less$/, 
                use: [MiniCssExtractPlugin.loader, 'css-loader', 'less-loader']
            },
            {
                //配置css中的图片打包
                test: /\.(png|jpg|gif)$/, 
                loader: 'url-loader',    
                options: {
                    name: '[hash:16].[ext]',  // 图片输出的名字hash长度16位 默认32位
                    limit: 30 * 1024,  // 限制 小于30kb base64处理
                    esModule: false,  
                },
            },
            {
                 //配置html文件打包
                test: /\.html$/,   
                loader: 'html-loader'
            },
            {
                //配置iconfont文件打包
                test: /\.(eot|svg|ttf|woff|woff2)$/, 
                loader: 'file-loader'
            },
            {
                // loader 编译es6为es5
                test: /\.js$/,
                loader: 'babel-loader',    
                exclude: /node_modules/  
            }

        ]
    },
    // 4. 插件
    plugins: [
        //配置html打包的插件
        new HtmlWebpackPlugin({   
            template: './src/index.html'         //以哪个html文件作为打包的模板
        }),
        // 配置css 提取js中的css代码到哪个css文件
        new MiniCssExtractPlugin({
            filename: 'css/[name].css' 
        }),
        //优化css 极致压缩
        new OptimizeCssAssetsWebpackPlugin()

    ],
    mode: process.env.NODE_ENV,
    //开发服务器配置
    devServer: {
        contentBase: path.resolve(__dirname, 'dist'), // 启动服务器目录
        compress: true, // 启动gzip
        port: 8080,  // 端口  8080 80  8081 8082
        open: true, // 自动打开服务
        publicPath: '/', // 静态资源查找路径
        openPage: 'index.html', // 打开的页面
    },
    target: 'web', // 目标是浏览器
}
```

#### 1.3.3  .babelrc

```js
{
      "presets": [
          "es2015"
      ]
}
```

#### 1.3.4 修改webpack.config.js 能够打包home页面

```js
/**
 * webpack 打包配置文件
 */

//引入nodejs内置模块，可以拿到当前文件的跟目录
const path = require('path');
//引入html打包的插件 
const HtmlWebpackPlugin = require('html-webpack-plugin');
//引入 提取js中的css代码的插件
const MiniCssExtractPlugin = require('mini-css-extract-plugin');
//将css文件及代码进行极致压缩s
const OptimizeCssAssetsWebpackPlugin = require('optimize-css-assets-webpack-plugin');

module.exports = {
    //入口
    entry: './src/js/home.js',   //相对路径
    //出口
    output: {
        path: path.resolve(__dirname, 'dist'),   
        filename: 'home.js',       
        publicPath: './'            
    },
    //loader 
    module: {
        rules: [
            { 
                //配置css loader
                test: /\.css$/,          
                use: [MiniCssExtractPlugin.loader, 'css-loader']
            },
            {
                //配置less loader 
                test: /\.less$/, 
                use: [MiniCssExtractPlugin.loader, 'css-loader', 'less-loader']
            },
            {
                //配置css中的图片打包
                test: /\.(png|jpg|gif)$/, 
                loader: 'url-loader',    
                options: {
                    name: '[hash:16].[ext]',  // 图片输出的名字hash长度16位 默认32位
                    limit: 30 * 1024,  // 限制 小于30kb base64处理
                    esModule: false, 
                    outputPath:'img'      //输出图片到img目录
                },
            },
            {
                 //配置html文件打包
                test: /\.html$/,   
                loader: 'html-loader'
            },
            {
                //配置iconfont文件打包
                test: /\.(eot|svg|ttf|woff|woff2)$/, 
                loader: 'file-loader',
                 options:{
                    outputPath:'fonts'   //输出字体图标文件到fonts目录
                }
            },
            {
                // loader 编译es6为es5
                test: /\.js$/,
                loader: 'babel-loader',    
                exclude: /node_modules/  
            }

        ]
    },
    // 4. 插件
    plugins: [
        //配置html打包的插件
        new HtmlWebpackPlugin({   
            template: './src/page/home.html',         //以哪个html文件作为打包的模板
            filename:'home.html'
        }),
        // 配置css 提取js中的css代码到哪个css文件
        new MiniCssExtractPlugin({
            filename: 'css/home.css' 
        }),
        //优化css 极致压缩
        new OptimizeCssAssetsWebpackPlugin()

    ],
    mode: process.env.NODE_ENV,
    //开发服务器配置
    devServer: {
        contentBase: path.resolve(__dirname, 'dist'), // 启动服务器目录
        compress: true, // 启动gzip
        port: 8080,  // 端口  8080 80  8081 8082
        open: true, // 自动打开服务
        publicPath: '/', // 静态资源查找路径
        openPage: 'home.html', // 打开的页面
    },
    target: 'web', // 目标是浏览器
}
```

yarn build 打包之后dist目录的结构为

```js
dist
├── css
│   └── home.css
├── home.html
└── home.js
```

### 1.4 多页面打包 

修改webpack.config.js

```js
     //入口
    entry:{
        common:'./src/js/common.js',  //公共样式 公共js引入 必须放到最前面  

        home: './src/js/home.js',
        login: './src/js/login.js',
        register: './src/js/register.js',
    },   
    //出口
    output: {
        path: path.resolve(__dirname, 'dist'),   
        filename: 'js/[name]-[hash:10].js',       
        publicPath: './'            
    }, 
        
     plugins: [
        //配置html打包的插件
        new HtmlWebpackPlugin({   
            template: './src/page/home.html',         //以哪个html文件作为打包的模板
            filename:'home.html',
            chunks:['home','common'],
        }),
        new HtmlWebpackPlugin({   
            template: './src/page/login.html',         //以哪个html文件作为打包的模板
            filename:'login.html',
            chunks:['login','common'],
        }),
        new HtmlWebpackPlugin({   
            template: './src/page/register.html',         //以哪个html文件作为打包的模板
            filename:'register.html',
            chunks:['register','common'],
        }),

         
        // 配置css 提取js中的css代码到哪个css文件
        new MiniCssExtractPlugin({
            filename: 'css/[name]-[hash:10].css' 
        }),
        //优化css 极致压缩
        new OptimizeCssAssetsWebpackPlugin()

    ],    
```

打包后dist目录结构

```js
dist
├── css
│   ├── common-36e9d29edf.css
│   ├── home-36e9d29edf.css
│   ├── login-36e9d29edf.css
│   └── register-36e9d29edf.css
├── fonts
│   ├── 1bf70b9e1c2fd0960ea8449b0fc8c7c8.svg
│   ├── 51e6fb6fdbfa990c21511c140dd43e59.ttf
│   ├── 8d0dd7f4072ec555053184416497fa20.woff
│   └── c67019eca1b3532577ac49d8709b1b63.eot
├── img
│   └── 2ba864dc3c3e4e54.jpg
├── js
│   ├── common-36e9d29edf.js
│   ├── home-36e9d29edf.js
│   ├── login-36e9d29edf.js
│   └── register-36e9d29edf.js
├── home.html
├── login.html
└── register.html
```



## 2.优化多页面打包项目

### 2.1 自动清除dist 

每次打包之前先将原来的dist目录删除再进行打包

- 下载并引入插件 
- 配置plugin

```js
yarn add clean-webpack-plugin -D
```

```js
const { CleanWebpackPlugin } = require('clean-webpack-plugin')

//plugin中配置
new CleanWebpackPlugin(),
```

### 2.2 css代码兼容性处理

处理低版本浏览器不支持的css样式 进行css代码的兼容性转换，开发中不再需要写兼容性的css代码

- 下载loader 及插件   postcss-loader       postcss-preset-env

- 修改loader中关于css的配置 添加上postcss-loader 
- 修改package.json 
- 项目根目录下新增postcss.config.js 

```js
yarn add postcss-loader postcss-preset-env -D
```

- webpack.config.js  loader‘配置

```js
            { 
                //配置css loader
                test: /\.css$/,          
                use: [MiniCssExtractPlugin.loader, 'css-loader','postcss-loader']
            },
            {
                //配置less loader 
                test: /\.less$/, 
                use: [MiniCssExtractPlugin.loader, 'css-loader', 'postcss-loader','less-loader']
            },
```

- package.json 配置

```js
//package.json 末尾添加

"browserslist": {
    "development": [
      "last 1 chrome version",
      "last 1 firefox version",
      "last 1 safari version"
    ],
    "production": [
      ">0.1%"
    ]
  }
```

- postcss.config.js 配置

```js
//根目录新增的postcss.config.js
module.exports = {
    plugins: [
        // postcss插件
        require('postcss-preset-env')()
    ]
}
```



